import dispatcher from '../dispatcher';
import { EventEmitter } from 'events';

export const events = {
    NEW_CONTACT_SAVED: 'newcontactsaved',
    SELECTION_SAVED: 'selectionchanged',
    CONTACT_DELETED: 'contactdeleted'
};

class ContactsStore extends EventEmitter {
    constructor() {
        super();
        this.contactList = [{ "gender": "female", "name": { "first": "lillian", "last": "jensen" }, "location": { "street": "7830 stevens creek blvd", "city": "mesa", "state": "oregon", "postcode": 59709 }, "email": "lillian.jensen@example.com", "dob": "1946-08-16 23:27:50", "phone": "(081)-584-5589", "picture": { "large": "https://randomuser.me/api/portraits/women/20.jpg", "medium": "https://randomuser.me/api/portraits/med/women/20.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/20.jpg" }, "id": 1 }, { "gender": "female", "name": { "first": "penny", "last": "hale" }, "location": { "street": "7020 locust rd", "city": "shepparton", "state": "south australia", "postcode": 5066 }, "email": "penny.hale@example.com", "dob": "1992-04-21 11:42:32", "phone": "02-1447-2026", "picture": { "large": "https://randomuser.me/api/portraits/women/59.jpg", "medium": "https://randomuser.me/api/portraits/med/women/59.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/59.jpg" }, "id": 2 }, { "gender": "male", "name": { "first": "william", "last": "bonnet" }, "location": { "street": "8222 rue des jardins", "city": "angers", "state": "haute-marne", "postcode": 13191 }, "email": "william.bonnet@example.com", "dob": "1989-10-29 21:21:36", "phone": "05-03-47-28-13", "picture": { "large": "https://randomuser.me/api/portraits/men/89.jpg", "medium": "https://randomuser.me/api/portraits/med/men/89.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/89.jpg" }, "id": 3 }, { "gender": "male", "name": { "first": "jack", "last": "harcourt" }, "location": { "street": "2927 st. lawrence ave", "city": "cornwall", "state": "newfoundland and labrador", "postcode": 38931 }, "email": "jack.harcourt@example.com", "dob": "1979-07-09 22:35:07", "phone": "142-527-2070", "picture": { "large": "https://randomuser.me/api/portraits/men/61.jpg", "medium": "https://randomuser.me/api/portraits/med/men/61.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/61.jpg" }, "id": 4 }, { "gender": "male", "name": { "first": "mae", "last": "brun" }, "location": { "street": "5479 rue des jardins", "city": "saint-pierre", "state": "deux-sèvres", "postcode": 77970 }, "email": "mae.brun@example.com", "dob": "1978-04-25 16:55:52", "phone": "01-68-14-51-24", "picture": { "large": "https://randomuser.me/api/portraits/men/52.jpg", "medium": "https://randomuser.me/api/portraits/med/men/52.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/52.jpg" }, "id": 5 }, { "gender": "male", "name": { "first": "batista", "last": "lima" }, "location": { "street": "1403 rua santo antônio ", "city": "serra", "state": "espírito santo", "postcode": 93219 }, "email": "batista.lima@example.com", "dob": "1947-07-06 09:11:34", "phone": "(27) 0564-1238", "picture": { "large": "https://randomuser.me/api/portraits/men/32.jpg", "medium": "https://randomuser.me/api/portraits/med/men/32.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/32.jpg" }, "id": 6 }, { "gender": "male", "name": { "first": "gustav", "last": "wagner" }, "location": { "street": "6892 marktplatz", "city": "landau i.d. pfalz", "state": "mecklenburg-vorpommern", "postcode": 38744 }, "email": "gustav.wagner@example.com", "dob": "1977-04-12 09:42:31", "phone": "0290-1945492", "picture": { "large": "https://randomuser.me/api/portraits/men/28.jpg", "medium": "https://randomuser.me/api/portraits/med/men/28.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/28.jpg" }, "id": 7 }, { "gender": "female", "name": { "first": "vicky", "last": "lawrence" }, "location": { "street": "9047 green lane", "city": "athenry", "state": "mayo", "postcode": 54609 }, "email": "vicky.lawrence@example.com", "dob": "1951-12-06 22:37:40", "phone": "051-418-1832", "picture": { "large": "https://randomuser.me/api/portraits/women/88.jpg", "medium": "https://randomuser.me/api/portraits/med/women/88.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/88.jpg" }, "id": 8 }, { "gender": "female", "name": { "first": "jessie", "last": "evans" }, "location": { "street": "4381 mockingbird hill", "city": "gladstone", "state": "queensland", "postcode": 7045 }, "email": "jessie.evans@example.com", "dob": "1962-12-26 20:26:04", "phone": "01-2231-4817", "picture": { "large": "https://randomuser.me/api/portraits/women/36.jpg", "medium": "https://randomuser.me/api/portraits/med/women/36.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/36.jpg" }, "id": 9 }, { "gender": "male", "name": { "first": "rasmus", "last": "toro" }, "location": { "street": "8078 nordenskiöldinkatu", "city": "tohmajärvi", "state": "åland", "postcode": 98923 }, "email": "rasmus.toro@example.com", "dob": "1990-08-13 02:52:02", "phone": "07-055-749", "picture": { "large": "https://randomuser.me/api/portraits/men/23.jpg", "medium": "https://randomuser.me/api/portraits/med/men/23.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/23.jpg" }, "id": 10 }, { "gender": "female", "name": { "first": "brooke", "last": "jackson" }, "location": { "street": "4417 fergusson drive", "city": "taupo", "state": "tasman", "postcode": 86956 }, "email": "brooke.jackson@example.com", "dob": "1987-10-04 11:38:43", "phone": "(456)-614-7315", "picture": { "large": "https://randomuser.me/api/portraits/women/71.jpg", "medium": "https://randomuser.me/api/portraits/med/women/71.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/71.jpg" }, "id": 11 }, { "gender": "male", "name": { "first": "mark", "last": "kremer" }, "location": { "street": "4632 kastanienweg", "city": "dingolfing-landau", "state": "saarland", "postcode": 38288 }, "email": "mark.kremer@example.com", "dob": "1973-05-24 03:27:37", "phone": "0818-4444583", "picture": { "large": "https://randomuser.me/api/portraits/men/43.jpg", "medium": "https://randomuser.me/api/portraits/med/men/43.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/43.jpg" }, "id": 12 }, { "gender": "female", "name": { "first": "susana", "last": "calvo" }, "location": { "street": "7007 calle de alcalá", "city": "vigo", "state": "melilla", "postcode": 29060 }, "email": "susana.calvo@example.com", "dob": "1961-07-23 12:41:09", "phone": "961-070-230", "picture": { "large": "https://randomuser.me/api/portraits/women/13.jpg", "medium": "https://randomuser.me/api/portraits/med/women/13.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/13.jpg" }, "id": 13 }, { "gender": "female", "name": { "first": "jessica", "last": "white" }, "location": { "street": "1332 novara avenue", "city": "dungarvan", "state": "donegal", "postcode": 33856 }, "email": "jessica.white@example.com", "dob": "1988-01-06 14:14:55", "phone": "021-214-9047", "picture": { "large": "https://randomuser.me/api/portraits/women/81.jpg", "medium": "https://randomuser.me/api/portraits/med/women/81.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/81.jpg" }, "id": 14 }, { "gender": "female", "name": { "first": "کیانا", "last": "موسوی" }, "location": { "street": "1459 شهید مطهری", "city": "پاکدشت", "state": "هرمزگان", "postcode": 95671 }, "email": "کیانا.موسوی@example.com", "dob": "1954-08-25 07:14:00", "phone": "046-63708619", "picture": { "large": "https://randomuser.me/api/portraits/women/65.jpg", "medium": "https://randomuser.me/api/portraits/med/women/65.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/65.jpg" }, "id": 15 }, { "gender": "male", "name": { "first": "jeffery", "last": "parker" }, "location": { "street": "6613 queen street", "city": "durham", "state": "warwickshire", "postcode": "VR4U 6UD" }, "email": "jeffery.parker@example.com", "dob": "1984-01-22 20:17:19", "phone": "016977 96010", "picture": { "large": "https://randomuser.me/api/portraits/men/32.jpg", "medium": "https://randomuser.me/api/portraits/med/men/32.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/32.jpg" }, "id": 16 }, { "gender": "female", "name": { "first": "ömür", "last": "yetkiner" }, "location": { "street": "9597 doktorlar cd", "city": "muğla", "state": "aksaray", "postcode": 51520 }, "email": "ömür.yetkiner@example.com", "dob": "1966-08-21 03:28:32", "phone": "(153)-141-4082", "picture": { "large": "https://randomuser.me/api/portraits/women/85.jpg", "medium": "https://randomuser.me/api/portraits/med/women/85.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/85.jpg" }, "id": 17 }, { "gender": "female", "name": { "first": "veridiana", "last": "gonçalves" }, "location": { "street": "2622 rua alagoas ", "city": "caucaia", "state": "são paulo", "postcode": 44596 }, "email": "veridiana.gonçalves@example.com", "dob": "1950-11-21 23:10:12", "phone": "(29) 1766-8499", "picture": { "large": "https://randomuser.me/api/portraits/women/27.jpg", "medium": "https://randomuser.me/api/portraits/med/women/27.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/27.jpg" }, "id": 18 }, { "gender": "male", "name": { "first": "morris", "last": "henderson" }, "location": { "street": "4893 north road", "city": "maynooth", "state": "meath", "postcode": 99765 }, "email": "morris.henderson@example.com", "dob": "1979-11-16 15:21:40", "phone": "031-350-1233", "picture": { "large": "https://randomuser.me/api/portraits/men/34.jpg", "medium": "https://randomuser.me/api/portraits/med/men/34.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/34.jpg" }, "id": 19 }, { "gender": "female", "name": { "first": "allie", "last": "graves" }, "location": { "street": "4498 springfield road", "city": "midleton", "state": "louth", "postcode": 13050 }, "email": "allie.graves@example.com", "dob": "1982-08-13 02:31:13", "phone": "041-410-6694", "picture": { "large": "https://randomuser.me/api/portraits/women/6.jpg", "medium": "https://randomuser.me/api/portraits/med/women/6.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/6.jpg" }, "id": 20 }, { "gender": "female", "name": { "first": "anneli", "last": "mulders" }, "location": { "street": "6768 houtensepad", "city": "voorst", "state": "zeeland", "postcode": 28230 }, "email": "anneli.mulders@example.com", "dob": "1952-07-11 06:38:18", "phone": "(884)-719-5800", "picture": { "large": "https://randomuser.me/api/portraits/women/45.jpg", "medium": "https://randomuser.me/api/portraits/med/women/45.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/45.jpg" }, "id": 21 }, { "gender": "male", "name": { "first": "archie", "last": "green" }, "location": { "street": "1130 dyers road", "city": "greymouth", "state": "wellington", "postcode": 75994 }, "email": "archie.green@example.com", "dob": "1984-04-19 07:44:57", "phone": "(560)-918-3595", "picture": { "large": "https://randomuser.me/api/portraits/men/95.jpg", "medium": "https://randomuser.me/api/portraits/med/men/95.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/95.jpg" }, "id": 22 }, { "gender": "male", "name": { "first": "giovani", "last": "cardoso" }, "location": { "street": "1599 rua são josé ", "city": "itapipoca", "state": "ceará", "postcode": 30038 }, "email": "giovani.cardoso@example.com", "dob": "1965-06-22 11:14:00", "phone": "(43) 2482-5757", "picture": { "large": "https://randomuser.me/api/portraits/men/57.jpg", "medium": "https://randomuser.me/api/portraits/med/men/57.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/men/57.jpg" }, "id": 23 }, { "gender": "female", "name": { "first": "giulia", "last": "robin" }, "location": { "street": "1882 rue de l'abbé-soulange-bodin", "city": "fey", "state": "graubünden", "postcode": 9155 }, "email": "giulia.robin@example.com", "dob": "1966-12-20 10:25:31", "phone": "(645)-479-0622", "picture": { "large": "https://randomuser.me/api/portraits/women/74.jpg", "medium": "https://randomuser.me/api/portraits/med/women/74.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/74.jpg" }, "id": 24 }, { "gender": "female", "name": { "first": "عسل", "last": "سهيلي راد" }, "location": { "street": "4308 اجاره دار", "city": "پاکدشت", "state": "خراسان جنوبی", "postcode": 90039 }, "email": "عسل.سهيليراد@example.com", "dob": "1990-10-21 18:35:36", "phone": "046-25611028", "picture": { "large": "https://randomuser.me/api/portraits/women/69.jpg", "medium": "https://randomuser.me/api/portraits/med/women/69.jpg", "thumbnail": "https://randomuser.me/api/portraits/thumb/women/69.jpg" }, "id": 25 }];
        this.selectedContact = null;
    }

    getSelectedContact() {
        return new Promise((resolve, reject) => {
            resolve(this.selectedContact);
        });
    }

    // usage in the component:
    // contactStore.getAll().then(data=>{}).catch(err=>{});
    getAll() {
        return new Promise((resolve, reject) => {
            resolve(this.contactList);
        });
    }
    addNewContact(contact) {
        let maxId = this.contactList.reduce((a, b) => (a > b.id ? a : b.id), 0);
        contact.id = maxId + 1;
        let type = contact.gender == 'male' ? 'men' : 'women';
        contact.picture = {
            large: `https://randomuser.me/api/portraits/${type}/${contact.id}.jpg`,
            medium: `https://randomuser.me/api/portraits/med/${type}/${contact.id}.jpg`,
            thumbnail: `https://randomuser.me/api/portraits/thumb/${type}/${contact.id}.jpg`,
        }
        this.contactList.unshift(contact); // insert at index 0
        this.emit('newcontactsaved');
    }

    deleteContact(id) {
        let index = this.contactList.findIndex(c => c.id == id);
        if (index >= 0) {
            this.contactList.splice(index, 1);
            this.emit(events.CONTACT_DELETED);
        }
    }

    handleActions(action) {
        switch (action.type) {
            case 'ADD_NEW_CONTACT':
                this.addNewContact(action.data);
                break;
            case 'SELECTION_CHANGED':
                this.selectedContact = this.contactList.find(
                    c => c.id == action.data.id);
                this.emit('selectionchanged');
                break;
            case 'DELETE_CONTACT':
                this.deleteContact(action.data.id);
                break;
        }
    }
}

export const contactStore = new ContactsStore();
dispatcher.register(contactStore.handleActions.bind(contactStore));
